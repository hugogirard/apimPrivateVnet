# name: Test-Env

# on:  
#  push:
#    branches:
#      - features/deploywebapp

# jobs:
#   compile_bicep:
#     runs-on: ubuntu-latest 

#     steps:
#       - uses: actions/checkout@v2
      
#       # Compile bicep files
#       - name: Bicep Build
#         uses: aliencube/bicep-build-actions@v0.1
#         with:
#           files: bicep/deploy.bicep bicep/onpremise.bicep

#       # Deploy ARM Template
#       - name: Publish ARM Template
#         uses: actions/upload-artifact@v2.2.2
#         with:            
#           path: |
#             deploy.parameters.json
#             bicep/deploy.json
#             bicep/onpremise.json

#   deploy_dev:
#     needs: compile_bicep
#     runs-on: ubuntu-latest   

#     environment:
#       name: DEV

#     steps:      
#       - name: Azure Login
#         uses: Azure/login@v1.1
#         with:          
#           creds: ${{ secrets.SP_AZURE_CREDENTIALS }}          
#           enable-AzPSSession: false

#       # Create resource group
#       - name: Create Resource Group
#         run: |
#          az group create -n ${{ secrets.APIM_RESOURCE_GROUP_NAME }} -l ${{ secrets.LOCATION }}

#       # Replace parameters with secrets
#       - name: Replace tokens
#         uses: cschleiden/replace-tokens@v1.0
#         with:        
#           tokenPrefix: __        
#           tokenSuffix: __        
#           files: '["deploy.parameters.json"]'
#         env:
#           publisherName: ${{ secrets.PUBLISHER_NAME }}
#           publisherEmail: ${{ secrets.PUBLISHER_EMAIL }}
#           adminUsernameSql: ${{ secrets.ADMIN_USERNAME_SQL }}
#           adminPasswordSql: ${{ secrets.ADMIN_PASSWORD_SQL }}
#           hostname: ${{ secrets.HOSTNAME }}
#           adminUsername: ${{ secrets.ADMIN_USERNAME }}
#           adminPassword: ${{ secrets.ADMIN_PASSWORD }}
#           principalAdminObjectId: ${{ secrets.ADMIN_VAULT_OBJECT_ID }}
#           spIdentity: ${{ secrets.SP_PRINCIPAL_OBJECT_ID }}              